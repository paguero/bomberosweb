<!DOCTYPE html>
<html lang="es" translate="no">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="theme-color" content="#212f40">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <link rel="stylesheet" href="/splash-screen.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;700&display=swap" rel="stylesheet">
    <title>Soap Bomberos. Héroes de Verdad. Compra tu SOAP 2025</title>
    <meta name="description" content="Compra tu SOAP 2025 y ayuda a Bomberos aportando desde tan solo $1.000 pesos. Soap con sentido. Soap Solidario. #HEROESDEVERDAD">
    <!-- Facebook Meta Tags -->
    <meta property="og:url" content="https://www.soapbomberos.cl">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Soap Bomberos. Héroes de Verdad #HEROESDEVERDAD">
    <meta property="og:description" content="Compra tu SOAP 2025 y ayuda a Bomberos aportando desde tan solo $1.000 pesos. Soap con sentido. Soap Solidario. #HEROESDEVERDAD">
    <meta property="og:image" content="https://www.soapbomberos.cl/media/img/logotipo.png">
    <!-- Twitter Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta property="twitter:domain" content="soapbomberos.cl">
    <meta property="twitter:url" content="https://www.soapbomberos.cl">
    <meta name="twitter:title" content="Soap Bomberos. Héroes de Verdad #HEROESDEVERDAD">
    <meta name="twitter:description" content="Compra tu SOAP 2025 y ayuda a Bomberos aportando desde tan solo $1.000 pesos. Soap con sentido. Soap Solidario. #HEROESDEVERDAD">
    <meta name="twitter:image" content="https://www.soapbomberos.cl/media/img/logotipo.png">
    
    <link rel="stylesheet" href="https://www.gstatic.com/dialogflow-console/fast/df-messenger/prod/v1/themes/df-messenger-default.css">
    <script src="https://www.gstatic.com/dialogflow-console/fast/df-messenger/prod/v1/df-messenger.js"></script>

    <!-- Hotjar Tracking Code for Bomberos -->
    <script>
      (function(h,o,t,j,a,r){
          h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
          h._hjSettings={hjid:3867948,hjsv:6};
          a=o.getElementsByTagName('head')[0];
          r=o.createElement('script');r.async=1;
          r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
          a.appendChild(r);
      })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
    </script>
    <script>
      !function(f,b,e,v,n,t,s)
        {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
        n.callMethod.apply(n,arguments):n.queue.push(arguments)};
        if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
        n.queue=[];t=b.createElement(e);t.async=!0;
        t.src=v;s=b.getElementsByTagName(e)[0];
        s.parentNode.insertBefore(t,s)}(window, document,'script',
        'https://connect.facebook.net/en_US/fbevents.js');
        fbq('init', '163150238785333');
        fbq('track', 'PageView');
        </script>
        <noscript><img height="1" width="1" style="display:none"
        src="https://www.facebook.com/tr?id=163150238785333&ev=PageView&noscript=1"
        /></noscript>
        <!-- End Facebook Pixel Code -->
</head>

<body class="page-loading">
    <!--begin::Theme mode setup on page load-->
    <script>
        let themeMode = "system";

        if (localStorage.getItem("kt_theme_mode_value")) {
            themeMode = localStorage.getItem("kt_theme_mode_value");
        }

        if (themeMode === "system") {
            themeMode = window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light";
        }

        document.documentElement.setAttribute("data-bs-theme", themeMode);
    </script>
    <!--end::Theme mode setup on page load-->

    <div id="app"></div>

    <!--begin::Loading markup-->
    <div id="splash-screen" class="splash-screen">
        <img src="/media/logos/default.png" class="dark-logo" alt="Bomberos" />
        <img src="/media/logos/default.png" class="light-logo" alt="Bomberos" />
        <span>Cargando ...</span>
    </div>
    <!--end::Loading markup-->

    <script type="module" src="/src/main.ts"></script>

<!--
  <df-messenger
    location="us-central1"
    project-id="clientes-contratos"
    agent-id="9da97596-dd6a-4320-9690-302b11bf1471"
    language-code="es"
    storage-option="none"
    max-query-length="-1">
    <df-messenger-chat-bubble
    chat-icon="https:&#x2F;&#x2F;demo.camelsecure.com&#x2F;images&#x2F;sofia&#x2F;img-sofia.png"
    chat-title="pIA"
    >
    </df-messenger-chat-bubble>
    <div slot="header">
      <img src="https:&#x2F;&#x2F;demo.camelsecure.com&#x2F;images&#x2F;sofia&#x2F;img-sofia.png" alt="Logo">
    </div>
  </df-messenger>

  
<script>
  document.addEventListener('DOMContentLoaded', function() {
  const dfMessenger = document.querySelector('df-messenger');
  // Espera a que el componente df-messenger esté completamente cargado y el agente esté disponible
    window.addEventListener('df-messenger-loaded', () => {
      const dfMessenger = document.querySelector('df-messenger');
      const agent = dfMessenger.agent;
    });
    window.addEventListener('df-chat-open-changed', (event) => {
      console.log(`Chat is ${event.detail.isOpen ? 'open' : 'closed'}`);
    });

    window.addEventListener('df-user-input-entered', (event) => {
      console.log(event.detail.input);
    });

    window.addEventListener('df-request-sent', (event) => {
      console.log('Request', event.detail.data.requestBody);
    });

    window.addEventListener('df-response-received', async (event) => {
      // Remove all non-text messages.
      console.log('df-response-received ' + JSON.stringify(event.detail));
      if(event.detail.raw?.queryResult && event.detail.raw?.queryResult.webhookPayloads && event.detail.raw?.queryResult.webhookPayloads.length>0){
        var cotiza = event.detail.raw?.queryResult?.webhookPayloads[0].parameters;
        console.log('df-response-received ' + JSON.stringify(cotiza));
        
        localStorage.carro = JSON.stringify({carroId:cotiza.carro_id, cotizacionId:cotiza.cotizacion_id});
        dfMessenger.renderCustomText('Estamos listos, redirigiendo...');
        location.href = '/info-vehiculo/'+cotiza.cotizacion_id;
      }
      // Verifica si hay un customPayload
     /* if (event.detail.data.messages) {
        event.detail.data.messages.forEach(message => {
          if (message.type=="customCard") {
            const payload = message;
            // Renderiza el contenido del customPayload
            message.richElements.forEach(item => {
              //content.forEach(item => {
                  
                if (item.type === 'image') {
                  const img = document.createElement('img');
                  img.src = item.rawUrl;
                  img.alt = item.accessibilityText;
                  document.body.appendChild(img);
                } else if (item.type === 'info') {
                  const card = document.createElement('div');
                  card.innerHTML = `<h3>${item.title}</h3><p>${item.subtitle}</p><a href="${item.actionLink}">Enlace</a>`;
                  document.body.appendChild(card);
                } else if (item.type === 'selectableOptions') {
                  const optionsContainer = document.createElement('div');
                  item.options.forEach(option => {
                    console.log('item.options ', JSON.stringify(option));    
                    const button = document.createElement('button');
                    button.textContent = option.text;
                    button.value = option.value;

                    // Agrega un evento click a cada botón
                    button.addEventListener('click', () => {
                      // Envía la opción seleccionada al agente
                      agent.setParameters({
                        "opcion_seleccionada": option.value
                      });

                      // Puedes opcionalmente enviar un evento
                      agent.triggerEvent('OPCION_SELECCIONADA');
                    });

                    optionsContainer.appendChild(button);
                  });

                  document.body.appendChild(optionsContainer);
                }
             // });
            });
          }
        });
      }    */                 


      console.log('Response', event.detail.data.messages);
      /*event.detail.data.messages = event.detail.data.messages.filter(message => {
        return message.type === 'text';
      });*/
    });
      
      
      agent.on('request', (event) => {
        console.log("Solicitud enviada a Dialogflow:", event.requestBody.queryInput.text);
        // ... (resto de tu código)
      });

      agent.on('response', (event) => {
        console.log("Respuesta recibida de Dialogflow:", event.responseBody);
        // ... (resto de tu código)
      });

      agent.on('error', (error) => {
        console.error("Error en la comunicación con Dialogflow:", error);
        // ... (resto de tu código)
      });
      agent.on("EVENT_CREATE_SHOP", function(event) {
        // Ejecuta tu función JavaScript aquí
        miFuncionJavaScript();
      });
      function miFuncionJavaScript() {
        alert("¡La función JavaScript se ha ejecutado!");
      }

});
</script>

  <style>
    df-messenger {
      z-index: 999;
      position: fixed;
      --df-messenger-font-color: #000;
      --df-messenger-font-family: Google Sans;
      --df-messenger-chat-background: #f3f6fc;
      --df-messenger-message-user-background: #d3e3fd;
      --df-messenger-message-bot-background: #fff;
      bottom: 16px;
      right: 16px;
    }
  </style>
-->

</body>

</html>